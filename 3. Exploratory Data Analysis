######################################################################
## Exploratory Data Analysis
######################################################################

## Addressed N/A values
## Can modify ggplot(data = HxMx) to ggplot(data = subset(HxMx, !is.na([field])))
## Updated term, LoE_DI, YoB, gender, letter_grade

## Need to address Semester field
## Examples: Fall 2012, Spring 2013, Fall 2012 and Spring 2013
## Change to just Fall 2012, spring 2013, Summer 2013
## How to address courses that cross over terms?

## Need to address Warning message: Removed N rows containing non-finite values (stat_count)
## Applies to grade, last_event_DI, nevents, nevents_ind, ndays_act, ndays_act_ind, nplay_video,
## npaly_video_ind, nchapters, nchapters_ind, incomplete_flag

## Load needed packages
library(ggplot2)
library(scales)
library(DataExplorer)

########## Exploratory Data Analysis with DataExplorer

## Explore DataExplorer Package

plot_str(HxMx)
plot_missing(HxMx)
plot_histogram(HxMx)
plot_density(HxMx)
plot_bar(HxMx)
create_report(HxMx)



########## Exploratory Data Analysis - Part 1: Single Variable

## Course ID
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = course_id)) +
  scale_x_discrete(name = " ") +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_text(angle=90, vjust=0.5)) +
  labs(title = "Course ID")

## Institution
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = institution)) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank()) +
  labs(title = "Institution") 

## Course code
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = course_code)) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_text(angle=90, vjust=0.5)) +
  labs(title = "Course Code") 

## Year & Term
#ggplot(data = HxMx) +
#  geom_bar(mapping = aes(x = year_term)) +
#  scale_y_continuous(name=" ", labels = comma) +
#  theme(axis.title.x = element_blank()) +
#  labs(title = "Year & Term") 
## Repetitive and not as clean as Year and Term below

## Year
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = year)) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank()) +
  labs(title = "Year") 

## Term
ggplot(data = subset(HxMx, !is.na(term))) +
  geom_bar(mapping = aes(x = term)) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank()) +
  labs(title = "Term") 

## Semester
## CLEAN UP - DUPLICATION IN VALUES
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = semester)) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_text(angle=90, vjust=0.5)) +
  labs(title = "Semester") 

## User ID
## Too many records to show cleanly
#ggplot(data = HxMx) +
#  geom_bar(mapping = aes(x = userid_DI)) +
#  theme(axis.title.x = element_blank()) +
#  labs(title = "User Id")

## Registered
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = registered)) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank()) +
  labs(title = "Registered")

## Viewed
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = viewed)) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank()) +
  labs(title = "Viewed") 

## Explored
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = explored)) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank()) +
  labs(title = "Explored") 

## Certified
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = certified)) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank()) +
  labs(title = "Certified") 

## Country code
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = final_cc_cname_DI)) +
  scale_x_discrete(name = " ") +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_text(angle=90, vjust=0.5)) +
  labs(title = "Country Code")

## Level of education
ggplot(data = subset(HxMx, !is.na(LoE_DI))) +
  geom_bar(mapping = aes(x = LoE_DI)) +
  scale_x_discrete(name = " ") +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_text(angle=90, vjust=0.5)) +
  labs(title = "Level of Education")

## Year of birth
ggplot(data = subset(HxMx, !is.na(YoB))) +
  geom_bar(mapping = aes(x = YoB)) +
  scale_x_discrete(name = " ") +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_text(angle=90, vjust=0.5)) +
  labs(title = "Year of Birth")
  
## Gender
ggplot(data = subset(HxMx, !is.na(gender))) +
  geom_bar(mapping = aes(x = gender)) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank()) +
  labs(title = "Gender") 

## Grade
## Removed 57400 rows containing non-finite values (stat_count)
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = grade)) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank()) +
  labs(title = "Grade") 

## Letter grade
ggplot(data = subset(HxMx, !is.na(letter_grade))) +
  geom_bar(mapping = aes(x = letter_grade)) +
  scale_x_discrete(limits = c("A","B","C","D","F")) + #,NA)) + inclue for NA
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank()) +
  labs(title = "Letter Grade") 

## Start time
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = start_time_DI)) +
  scale_x_date (name = " ") +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_text(angle=90, vjust=0.5)) +
  labs(title = "Start Time")

## Last event
## Removed 178954 rows containing non-finite values (stat_count)
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = last_event_DI)) +
  scale_x_date (name = " ") +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_text(angle=90, vjust=0.5)) +
  labs(title = "Last Event")  

## Number of events
## Removed 199151 rows containing non-finite values (stat_count)
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = nevents)) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank()) +
  labs(title = "Number of Events") 

## Events indicator
## Removed 199151 rows containing non-finite values (stat_count)
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = nevents_ind)) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank()) +
  labs(title = "Participated in an Event") 

## Number of days active
## Removed 162743 rows containing non-finite values (stat_count)
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = ndays_act)) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank()) +
  labs(title = "Number of Days") 

## Days active indicator
## Removed 162743 rows containing non-finite values (stat_count)
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = ndays_act_ind)) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank()) +
  labs(title = "Was Active") 

## Number of video plays
## Removed 457530 rows containing non-finite values (stat_count)
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = nplay_video)) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank()) +
  labs(title = "Number of Video Plays") 

## Video plays indicator
## Removed 457530 rows containing non-finite values (stat_count)
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = nplay_video_ind)) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank()) +
  labs(title = "Played Video") 

## Number of chapters
## Removed 258753 rows containing non-finite values (stat_count)
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = nchapters)) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank()) +
  labs(title = "Number of Chapters") 

## Chapters indicator
## Removed 258753 rows containing non-finite values (stat_count)
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = nchapters_ind)) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank()) +
  labs(title = "Read a Chapter") 

## Number of forum posts
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = nforum_posts)) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank()) +
  labs(title = "Number of Forum Posts") 

## Forum posts indicator
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = nforum_posts_ind)) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank()) +
  labs(title = "Posted in Forum") 

## Roles
## All values are NULL - remove
#ggplot(data = HxMx) +
#  geom_bar(mapping = aes(x = roles)) +
#  scale_y_continuous(name=" ", labels = comma) +
#  theme(axis.title.x = element_blank()) +
#  labs(title = "Roles") 

## Inconsistent Flag
## Removed 540977 rows containing non-finite values (stat_count)
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = incomplete_flag)) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank()) +
  labs(title = "Incomplete Flag") 

## Short title
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = short_title)) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_text(angle=90, vjust=0.5)) +
  labs(title = "Course Short Title") 

## Full title
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = full_title)) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 40)) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_text(angle=90, vjust=0.5)) +
  labs(title = "Course Full Title") 



########## Exploratory Data Analysis - Part 2: Multi-Variable

## First attempt at Institution x Grade (colored by letter_grade)
## Still a work in progress
ggplot(data = HxMx) +
  geom_point(mapping = aes(x = institution, y=grade, color=letter_grade)) +
  scale_y_continuous(name=" ", labels = comma) +
  labs(title = "Grades by Institution")

## First attempt at Grade x Institution
## Still a work in progress
ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = grade)) +
  facet_grid(. ~HxMx$institution) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank()) +
  labs(title = "Grade") 

ggplot(data = HxMx) +
  geom_bar(mapping = aes(x = grade)) +
  facet_grid(institution ~ short_title) +
  scale_y_continuous(name=" ", labels = comma) +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_text(angle=90, vjust=0.5)) +
  labs(title = "Grade")
  
